# sha256 as of 2020-06-30 for node:10-alpine
FROM node@sha256:bafda8e474ba8973f146cb3fc2d531cf7fb7fec73ef4ca04aa38f26db520a883 AS node-assets

# Install npm, making output less verbose
ARG NPM_VER=6.13.7
ENV NPM_CONFIG_LOGLEVEL warn
RUN npm install npm@${NPM_VER} -g

# Workaround to avoid webpack hanging, see:
# https://github.com/webpack/webpack-dev-server/issues/128
ENV UV_THREADPOOL_SIZE 128

ARG USERID=1000
# node image uses BusyBox adduser, so short options only
# The image already has a 'node' user
RUN adduser -D -g "" -u "${USERID}" docker_user

# Oddly, node-sass requires both python and make to build bindings
RUN apk add --no-cache paxctl python make g++
RUN paxctl -cm /usr/local/bin/node

USER ${USERID}
